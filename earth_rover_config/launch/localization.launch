<?xml version="1.0" encoding="UTF-8"?>
<launch>
    <arg name="zed_namespace"		    	default="zed" />
    <arg name="rplidar_namespace"		    default="rplidar" />
    <arg name="earth_rover_namespace"		default="earth_rover" />

    <arg name="rgb_topic"               	default="rgb/image_rect_color" />
    <arg name="depth_topic"             	default="depth/depth_registered" />
    <arg name="camera_info_topic"       	default="rgb/camera_info" />
    <arg name="depth_camera_info_topic" 	default="depth/camera_info" />
    <arg name="camera_frame"              default="zed_camera_center" />

    <!-- RTAB-map Node-->
    <include file="$(find rtabmap_ros)/launch/rtabmap.launch">
      <arg name="rtabmap_args"		        value="--delete_db_on_start" />
      <arg name="rtabmapviz"                value="false" />
      <arg name="rgb_topic"               	value="/$(arg zed_namespace)/$(arg rgb_topic)" />
      <arg name="depth_topic"             	value="/$(arg zed_namespace)/$(arg depth_topic)" />
      <arg name="camera_info_topic"       	value="/$(arg zed_namespace)/$(arg camera_info_topic)" />
      <arg name="depth_camera_info_topic" 	value="/$(arg zed_namespace)/$(arg depth_camera_info_topic)" />
      <arg name="frame_id"                  value="$(arg camera_frame)" />
      <arg name="approx_sync"               value="true" />
      <arg name="visual_odometry"           value="false" />
      <arg name="odom_topic"                value="/$(arg earth_rover_namespace)/odom" />
      <remap from="cloud_map" to="/$(arg rplidar_namespace)/scan" />
      
      <param name="subscribe_depth" type="bool" value="true"/>
      <param name="subscribe_scan"  type="bool" value="true"/>

      <!-- RTAB-Map's parameters -->
      <param name="RGBD/NeighborLinkRefining" type="string" value="true"/>
      <param name="RGBD/ProximityBySpace"     type="string" value="true"/>
      <param name="RGBD/AngularUpdate"        type="string" value="0.01"/>
      <param name="RGBD/LinearUpdate"         type="string" value="0.01"/>
      <param name="RGBD/OptimizeFromGraphEnd" type="string" value="false"/>
      <param name="RGBD/ProximityPathMaxNeighbors" type="string" value="10"/>
      <param name="Reg/Strategy"              type="string" value="1"/> <!-- 1=ICP -->
      <param name="Reg/Force3DoF"             type="string" value="true"/>
      <param name="Vis/MinInliers"            type="string" value="5"/>
      <param name="Vis/InlierDistance"        type="string" value="0.1"/>
      <param name="Rtabmap/TimeThr"           type="string" value="700"/>
      <param name="Mem/RehearsalSimilarity"   type="string" value="0.45"/>
      <param name="Grid/FromDepth"            type="string" value="false"/>
    </include>
</launch>
